### DO NOT EDIT THIS FILE
### This file is auto-generated by the Dyad command-line compiler.
### If you edit this code it is likely to get overwritten.
### Instead, update the Dyad source code and regenerate this file


@doc Markdown.doc"""
   SimplePowertrain(; name, base_torque, c_normalized_torque, tau, tau_start)

Powertrain model with throttle input and rotational torque output

## Parameters: 

| Name         | Description                         | Units  |   Default value |
| ------------ | ----------------------------------- | ------ | --------------- |
| `base_torque`         | Maximum torque capacity                         | N.m  |   150 |
| `c_normalized_torque`         | Normalized torque coefficients as a function of vehicle speed: c[1] + c[2]*vehicle_speed + c[3]*vehicle_speed^2 + c[3]*vehicle_speed^2                         | --  |   [12.343, -0.57128, 0.010451, -0.000062024] |
| `tau`         | Time constant for torque response                         | s  |   0.1 |
| `tau_start`         | Torque start value                         | N.m  |   0 |

## Connectors

 * `throttle` - This connector represents a real signal as an input to a component ([`RealInput`](@ref))
 * `vehicle_speed` - This connector represents a real signal as an input to a component ([`RealInput`](@ref))
 * `drive` - This connector represents a rotational spline with angle and torque as the potential and flow variables, respectively. ([`Spline`](@ref))

## Variables

| Name         | Description                         | Units  | 
| ------------ | ----------------------------------- | ------ | 
| `normalized_torque`         | Normalized torque                         | --  | 
| `torque`         | Actual torque being produced                         | N.m  | 
"""
@component function SimplePowertrain(; name, base_torque=150, c_normalized_torque=[12.343, -0.57128, 0.010451, -0.000062024], tau=0.1, tau_start=0)
  __params = Any[]
  __vars = Any[]
  __systems = System[]
  __guesses = Dict()
  __defaults = Dict()
  __initialization_eqs = []
  __eqs = Equation[]

  ### Symbolic Parameters
  append!(__params, @parameters (base_torque::Real = base_torque), [description = "Maximum torque capacity"])
  append!(__params, @parameters (c_normalized_torque[1:4]::Real = c_normalized_torque), [description = "Normalized torque coefficients as a function of vehicle speed: c[1] + c[2]*vehicle_speed + c[3]*vehicle_speed^2 + c[3]*vehicle_speed^2"])
  append!(__params, @parameters (tau::Real = tau), [description = "Time constant for torque response"])
  append!(__params, @parameters (tau_start::Real = tau_start), [description = "Torque start value"])

  ### Variables
  append!(__vars, @variables (throttle(t)::Real), [input = true])
  append!(__vars, @variables (vehicle_speed(t)::Real), [input = true])
  append!(__vars, @variables (normalized_torque(t)::Real), [description = "Normalized torque"])
  append!(__vars, @variables (torque(t)::Real), [description = "Actual torque being produced"])

  ### Constants
  __constants = Any[]

  ### Components
  push!(__systems, @named drive = __Dyad__Spline())

  ### Guesses

  ### Defaults
  __defaults[torque] = (tau_start)

  ### Initialization Equations

  ### Assertions
  __assertions = []

  ### Equations
  push!(__eqs, normalized_torque ~ c_normalized_torque[1] + c_normalized_torque[2] * vehicle_speed + c_normalized_torque[3] * vehicle_speed ^ 2 + c_normalized_torque[4] * vehicle_speed ^ 3)
  # First-order lag dynamics: torque response to throttle
  push!(__eqs, ModelingToolkit.D_nounits(torque) ~ (throttle * base_torque * normalized_torque - torque) / tau)
  # Torque acts on the drive spline
  push!(__eqs, drive.tau ~ -torque)

  # Return completely constructed System
  return System(__eqs, t, __vars, __params; systems=__systems, defaults=__defaults, guesses=__guesses, name, initialization_eqs=__initialization_eqs, assertions=__assertions)
end
export SimplePowertrain
